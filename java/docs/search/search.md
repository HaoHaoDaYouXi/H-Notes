# 搜索引擎

现在的系统，基本都有通用查询功能，就例如：商城网站的搜索，要可以根据商品名称、商品描述等信息进行搜索。这时就需要搜索引擎了。

搜索引擎是一种根据用户需求与特定算法，运用多种技术检索出指定信息并反馈给用户的信息检索工具。

目前Java开发中涉及到的主流有：Elasticsearch、Solr

## <a id="elasticsearch">Elasticsearch</a>

`Elasticsearch`是一个分布式、`RESTful`风格的搜索和数据分析引擎，能够解决不断涌现出的各种用例。
作为`Elastic Stack`的核心，它集中存储您的数据，帮助您发现意料之中以及意料之外的情况。

`ElasticSearch`是基于`Lucene`的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于`RESTful Web`接口。

`Elasticsearch`是用`Java`开发的，并作为`Apache`许可条款下的开放源码发布，是当前流行的企业级搜索引擎。

核心特点如下：
- 分布式的实时文件存储，每个字段都被索引且可用于搜索。
- 分布式的实时分析搜索引擎，海量数据下近实时秒级响应。
- 简单的`RESTful API`，天生的兼容多语言开发。
- 易扩展，处理`PB`级结构化或非结构化数据。

基本概念
- 文档（`Document`）：`Elasticsearch`中的基本单位，通常是一个`JSON`格式的对象。
- 索引（`Index`）：类似于数据库的概念，用于存储文档。
- 类型（`Type`）：在`Elasticsearch 7.x`版本之前，一个索引可以包含多个类型；`7.x`版本之后，一个索引只能包含一种类型。
- 映射（`Mapping`）：定义了文档的字段及其数据类型，类似于数据库表的结构定义。
- 分片（`Shard`）：`Elasticsearch`中的最小可寻址单元，每个索引可以被划分为多个分片，以实现水平扩展。
- 副本（`Replica`）：分片的副本，用于提高数据的可用性和容错性。

### `ELK Stack`

`ELK`分别代表`Elasticsearch`、`Logstash`和`Kibana`，这三个工具共同构成了一个完整的日志管理和分析解决方案。

#### `Elasticsearch`

- 简介：`Elasticsearch`是一个基于`Lucene`的分布式搜索和分析引擎，用于存储、搜索和分析大量的数据。
- 功能：
  - 索引：将日志数据索引化，以便快速检索。
  - 搜索：提供高效的全文搜索能力。
  - 聚合：支持对数据进行聚合分析，如统计、分组等。
- 特点：
  - 高性能：能够处理大量的数据和高并发的查询请求。
  - 可扩展性：支持水平扩展，可以通过添加更多的节点来提高性能和存储容量。
  - 易用性：提供`RESTful API`，支持多种编程语言的客户端。

#### `Logstash`

- 简介：`Logstash`是一个用于收集、解析和丰富日志数据的工具。
- 功能：
  - 输入：支持多种数据源，如文件、网络、数据库等。
  - 过滤：提供丰富的插件来解析和转换日志数据。
  - 输出：支持多种输出方式，如`Elasticsearch`、数据库等。
- 特点：
- 灵活性：支持多种插件，可以根据需求定制数据处理流程。
- 实时性：能够实时处理数据流。
- 可扩展性：支持集群部署，可以处理大量数据。

#### `Kibana`

- 简介：`Kibana`是一个用于可视化`Elasticsearch`数据的工具，提供了一个直观的`Web`界面。
- 功能：
  - 仪表板：创建自定义的仪表板来展示数据。
  - 图表：支持多种类型的图表，如折线图、柱状图、饼图等。
  - 搜索：提供高级搜索功能，可以进行复杂查询。
- 特点：
  - 易用性：提供图形界面，无需编程知识即可使用。
  - 交互性：支持实时刷新数据，可以动态调整视图。
  - 可定制性：支持自定义仪表板和视图。

#### `ELK Stack`的工作流程

- 数据收集：`Logstash`从各种数据源收集日志数据。
- 数据处理：`Logstash`对收集到的数据进行解析、转换和丰富。
- 数据存储：处理后的数据被发送到`Elasticsearch`中进行存储和索引。
- 数据可视化：`Kibana`从`Elasticsearch`中读取数据，并以图表和仪表板的形式展示。

#### 应用场景

- 日志分析：收集和分析系统日志，监控系统运行状态。
- 安全监控：监控网络流量和安全事件，发现潜在的安全威胁。
- 业务分析：分析用户行为数据，优化产品和服务。
- 性能监控：监控应用性能，定位性能瓶颈。

### <a id="cxlx">`Elasticsearch`查询类型</a>

`Elasticsearch`支持多种查询类型，这些查询类型可以大致分为两大类：精确匹配和全文检索匹配。

每种查询类型都有其特定的应用场景和特点
- 精确匹配用于：是否完全一致
- 全文检索用于：是否相关

下面是`Elasticsearch`中一些常用的查询类型及其简要说明：

精确匹配查询主要用于查找与查询条件完全一致的文档。这类查询通常用于数值比较、精确字符串匹配等场景
- `term`（精确）：用于查找包含特定值的文档。例如，查找所有`status`字段值为`0`的文档。
- `terms`（精确）：用于查找包含多个特定值的文档。例如，查找所有`status`字段值为`0`或`1`的文档。
- `term set`（精确）：用于查找包含特定值的文档，但值可以是一个集合。例如，查找所有`status`字段值为`0`或`1`或`2`的文档。
- `range`（范围）：用于查找字段值落在指定范围内的文档。例如，查找价格在`100`到`1000`之间的商品。
- `exists`（包含）：用于查找包含特定字段的文档。例如，查找所有包含`test`字段的文档。
- `prefix`（前缀）：用于查找字段值以特定前缀开头的文档。例如，查找所有`name`字段以`test`开头的。
- `ids`（精确）：用于查找包含特定ID的文档。例如，查找所有ID为`123`的文档。
- `fuzzy`（模糊）：根据字段中的模糊匹配进行查询，可以通过设置`fuzziness`参数来控制模糊程度，自动模式格式为：`AUTO:[low],[high]`，默认为`AUTO`相当于`AUTO:3,6`。
- `wildcard`（通配符）：用于通配符符号（`*`和`?`）进行模糊匹配。
- `regexp`（正则）：用于查找字段值符合正则表达式的文档。

全文检索，如：
- `match`：用于全文搜索，会对查询字段进行分词，匹配文档中包含指定词项的文档。例如，查找所有标题中包含`elasticsearch`的文档。
- `match_phrase`：用于短语搜索，会对查询字段进行分词，匹配包含指定短语的文档。例如，查找所有描述中包含`elasticsearch cluster`的文档。
- `match_phrase_prefix`：`match_phrase`的前缀匹配，对查询字段进行分词，匹配包含指定短语的文档，并允许短语中的词项之间存在短语前缀。例如，查找所有描述中包含`elasticsearch cluster`的文档，但允许`cluster`的前缀。
- `multi_match`：用于多字段全文搜索，对多个查询字段进行分词，匹配包含指定词项的文档。例如，查找所有标题和描述中包含`elasticsearch`的文档。
- `query_string`：用于全文搜索，对查询字段进行分词，匹配包含指定词项的文档，并支持模糊匹配、短语匹配等。例如，查找所有标题中包含`elasticsearch`的文档，并允许短语匹配。
- `more_like_this`：用于查找与指定文档相似的其他文档。例如，查找与一篇博客文章主题相似的其他文章。
- `bool`：用于组合多个查询条件和过滤器，支持必须（`must`）、应该（`should`）、不允许（`must_not`）等逻辑组合。

其他查询，如：
- `script_score`：用于根据自定义脚本来评分文档。
- `function_score`：用于根据自定义函数来评分文档。
- `has_child`：用于查找拥有特定子文档的文档。
- `has_parent`：用于查找属于特定父文档的文档。
- `nested`：用于在嵌套字段中进行查询。
- ...

match 查询示例，用于查找所有标题中包含 "elasticsearch" 的文档：
```
GET /my-index/_search
{
  "query": {
    "match": {
      "title": "elasticsearch"
    }
  }
}
``` 

## <a id="solr">Solr</a>








---- 
