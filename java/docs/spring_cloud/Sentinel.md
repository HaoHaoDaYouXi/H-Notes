# Sentinel

`Sentinel`是阿里巴巴开源的一个用于保护微服务架构的流量控制组件，
主要以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度来帮助您提升微服务架构的稳定性。

`Sentinel`的设计目标是简单易用，可以无缝集成到`Spring Cloud`、`Dubbo`等微服务框架中，同时也支持独立使用。
它适用于各种微服务架构，无论是单体应用还是复杂的分布式系统，都能提供有效的流量管理和保护策略。

代码仓库：https://github.com/alibaba/Sentinel
文档地址：https://sentinelguard.io/zh-cn/docs/introduction.html

## `Sentinel`代码模块

- `sentinel-adapter`：适配器模块，主要实现了对一些常见框架的适配
- `sentinel-benchmark`：基准测试模块，对核心代码的精确性提供基准测试
- `sentinel-cluster`：集群流控制模块，默认实现。
  - `sentinel-cluster-common-default`：用于集群传输和功能的通用模块 
  - `sentinel-cluster-client-default`：使用`Netty`作为底层传输库的默认集群客户端模块 
  - `sentinel-cluster-server-default`：默认集群服务器模块
- `sentinel-core`：核心模块，限流、降级、系统保护等都在这里实现
- `sentinel-dashboard`：控制台模块，可以对连接上的`sentinel`客户端实现可视化的管理
- `sentinel-demo`：示例模块，可参考怎么使用`sentinel`进行限流、降级等
- `sentinel-extension`：扩展模块，主要对`DataSource`进行了部分扩展实现
- `sentinel-logging`：日志模块，提供了日志输出的接口，以及一些默认实现
- `sentinel-transport`：传输模块，提供了基本的监控服务端和客户端的API接口，以及一些基于不同库的实现

## `Sentinel`提供了以下核心功能

- 流量控制: `Sentinel`可以基于资源、`URL`或者自定义规则进行限流，支持`QPS`和线程数两种限流方式，以及冷启动和预热机制。
- 熔断降级: 当下游服务出现异常或者响应时间过长时，`Sentinel`可以进行熔断，快速返回错误信息，避免雪崩效应。
- 系统保护: `Sentinel`可以根据系统的负载情况，比如线程池使用率、`CPU`使用率、入口`QPS`等指标，对整个系统进行保护，避免系统过载。
- 集群限流: `Sentinel`支持跨应用的集群限流，可以确保整个集群的稳定运行。
- 动态规则管理: `Sentinel`支持动态调整规则，无需重启应用即可生效，方便运维和管理。
- `Dashboard`: `Sentinel`提供了一个可视化的控制台，可以实时监控服务的运行状态和流量情况，并且可以动态调整规则。

## `Sentinel`的一些特性

### 流量控制

`Sentinel`提供丰富的流量控制策略，例如`QPS`（每秒查询率）限制、并发线程数限制。
支持基于请求来源的限流，可以对不同来源的请求分别进行流量控制。
支持预热模式，防止因系统启动时流量冲击导致的系统崩溃。

### 熔断降级

`Sentinel`支持异常数、异常比例和慢调用比例等多种降级策略。
提供触发熔断的条件配置，自动切断异常服务的请求，保护系统不发生雪崩效应。

### 热点参数限流

对频繁访问的热点数据进行参数级别的限流，更加精细化管理流量。
可以针对`API`中的特定“热点”参数进行流量控制，能够处理诸如`秒杀`场景下的热点限流问题。

### 系统保护

`Sentinel`可自适应地保护系统，当系统负载达到设定阈值时，会限制入口流量保护系统稳定。
通过监控系统负载情况，如`CPU`过高则自动进行流量控制。

### 实时监控和管理

`Sentinel`提供实时监控控制台，可视化显示监控信息并实时配置规则。
提供实时监控数据查看和机器发现的功能，方便用户进行系统调优管理。

### 集群流量控制

支持集群模式下的流量控制，能够在集群中统一管理和协调流量。
支持集群内流量分摊和重定向，以及灵活的流量分配策略。

### 开放扩展性

`Sentinel`提供扩展点，支持自定义限流器、降级器等。
支持与其它开源框架与类库的集成，如与`Spring Cloud`、`Dubbo`等深度集成。

### 动态规则配置

支持动态修改流控和降级规则，无需重启服务即可热更新规则。

### 异步请求支持

对异步请求提供等待队列时间设置，使得异步请求也能实现流量控制。

## `Sentinel`和`Hystrix`不同

`Sentinel`和`Hystrix`都是用于管理分布式系统中的服务可靠性和延迟容忍性的工具，它们提供了像熔断器、限流器和服务降级这样的功能。
虽然两者的目标类似，但它们在实现和功能上存在一些差异。

- 模块化与可扩展性
  - `Sentinel`：具有更模块化的设计，提供了更丰富的扩展点，易于个性化和扩展定制。
  - `Hystrix`：作为`Netflix OSS`套件的一部分，主要集成到`Spring Cloud Netflix`中，提供较固定的模式。
- 流量控制能力
  - `Sentinel`：专注于流量控制，包括限流、熔断、系统过载保护（通过系统负载来保护服务）、以及流量整形（调整流量分配）等。
  - `Hystrix`：主要是提供熔断器和线程隔离策略，用于隔离和管理故障。
- 控制台和监控
  - `Sentinel`：提供一个功能丰富的控制台，用于实时监控和操作规则配置调整。
  - `Hystrix`：提供了`Hystrix Dashboard`和`Turbine`，用于聚合和展示服务的指标。
- 性能表现
  - `Sentinel`：由于其轻量级的设计，对性能影响较小，适用于高并发场景。
  - `Hystrix`：由于其设计采用线程隔离，在高并发下可能因线程池的限制而对性能产生影响。
- 社区支持和维护状态
  - `Sentinel`：由阿里巴巴维护，并作为`Spring Cloud Alibaba`的一部分继续得到更新和支持。
  - `Hystrix`：自2018年起，进入维护模式，`Netflix`不再积极开发新特性。`Spring Cloud`项目也逐渐替换为其他替代方案，如`Resilience4j`。
- 易用性与配置
  - `Sentinel`：配置方式简单直观，容易入门，且规则配置的灵活性较高。
  - `Hystrix`：虽然与`Spring Cloud`集成得比较紧密，但学习曲线相对陡峭，配置项相对复杂。
- 异步编程模型
  - `Sentinel`：它天然支持响应式和异步编程模型。
  - `Hystrix`：虽然提供了对异步执行的支持，但更多的是以同步方式执行。
- 链路追踪与日志
  - `Sentinel`：针对链路入口和出口的流量，提供比较细粒度的流量追踪和记录。
  - `Hystrix`：提供了执行事件的日志功能，但相对较粗。

目前国内主流是使用`Sentinel`的。
